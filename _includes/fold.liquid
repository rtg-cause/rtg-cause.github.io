{%- comment -%}
_includes/fold.liquid
- Takes include.field, include.fold_char (@@FOLD@@), and include.max_len (75).
{%- endcomment -%}
{%- assign raw = include.field | default: "" -%}
{%- assign fold_char = include.fold_char -%}
{%- assign max_len = include.max_len | default: 75 -%}

{%- comment -%} Normalize content: replace newlines with a space {%- endcomment -%}
{%- assign raw = raw | replace: '\r\n', '\n' | replace: '\r', '\n' -%}
{%- assign raw = raw | split: '\n' | join: ' ' | strip -%}

{%- assign len = raw | size -%}
{%- assign num_chunks = len | divided_by: max_len | ceil -%}
{%- assign out = "" -%}

{%- for i in (0..num_chunks) -%}
  {%- assign chunk_start = i | times: max_len -%}

  {%- if chunk_start >= len -%}
    {%- break -%}
  {%- endif -%}

  {%- assign chunk = raw | slice: chunk_start, max_len -%}

  {%- if i == 0 -%}
    {%- assign out = out | append: chunk -%}
  {%- else -%}
    {%- comment -%} Use the folding placeholder {%- endcomment -%}
    {%- assign out = out | append: fold_char | append: chunk -%}
  {%- endif -%}
{%- endfor -%}

{{ out }}
